<!DOCTYPE html><html><head><title>Newtypes: Motivation</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="The Monix Developers" /><meta name="description" content="Macro-free helpers for defining newtypes in Scala." /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Newtypes: Motivation" /><meta name="title" property="og:title" content="Newtypes: Motivation" /><meta name="og:site_name" content="Newtypes" /><meta name="og:url" content="https://newtypes.monix.io/" /><meta name="og:type" content="website" /><meta name="og:description" content="Macro-free helpers for defining newtypes in Scala." /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Newtypes: Motivation" /><meta name="twitter:image" content="https://newtypes.monix.io/img/poster.png" /><meta name="twitter:description" content="Macro-free helpers for defining newtypes in Scala." /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@monix" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"></div><span>Newtypes</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  open"><a href="/docs/" title="Documentation" class="drop-nested">Documentation</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/docs/motivation.html" title="Motivation" class="active">Motivation</a> <a href="/docs/core.html" title="Defining Newtypes" class="">Defining Newtypes</a></div></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/monix/newtypes" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/monix/newtypes" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="monix" data-github-repo="newtypes"><div class="content-wrapper"><section><h1 id="motivation-for-newtypes">Motivation for Newtypes</h1>

<p>In other statically typed languages, such as Haskell, a <code class="language-plaintext highlighter-rouge">newtype</code> declaration creates a new type out of an existing one, like a type safe alias.</p>

<p>In Scala, this would be a perfectly acceptable newtype declaration, even if not ideal:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Surname</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
</code></pre></div></div>

<p>NOTE: the constructor has to take a single parameter. If it takes more than one parameter, technically it isn’t a newtype.</p>

<p>The purpose is static type safety:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// It's much safe to deal with this:</span>
<span class="k">def</span> <span class="nf">register</span><span class="o">(</span>
  <span class="n">fname</span><span class="k">:</span> <span class="kt">FirstName</span><span class="o">,</span>
  <span class="n">lname</span><span class="k">:</span> <span class="kt">LastName</span><span class="o">,</span>
  <span class="n">ea</span><span class="k">:</span> <span class="kt">EmailAddress</span><span class="o">,</span>
<span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Account</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>

<span class="c1">// ... than to deal with this ...</span>
<span class="k">def</span> <span class="nf">register</span><span class="o">(</span>
  <span class="n">firstName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">lastName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">emailAddress</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
<span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Account</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</code></pre></div></div>

<p>Note the invocation:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">register</span><span class="o">(</span>
  <span class="s">"Alex"</span><span class="o">,</span>
  <span class="s">"Nedelcu"</span><span class="o">,</span>
  <span class="s">"noreply@alexn.org"</span><span class="o">,</span>
<span class="o">)</span>
</code></pre></div></div>

<p>It’s easy to mix ordering, or to break the signature when we insert a new parameter between the existing ones. With lack of type safety, we have to rely on names:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">register</span><span class="o">(</span>
  <span class="n">firstName</span> <span class="k">=</span> <span class="s">"Alex"</span><span class="o">,</span>
  <span class="n">lastName</span> <span class="k">=</span> <span class="s">"Nedelcu"</span><span class="o">,</span>
  <span class="n">emailAddress</span> <span class="k">=</span> <span class="s">"noreply@alexn.org"</span><span class="o">,</span>
<span class="o">)</span>
</code></pre></div></div>

<p>But now we’re down to using discipline, as the compiler can’t protect us.</p>

<p>A second usage of newtypes is for working with <a href="https://typelevel.org/cats/">type classes</a> and defining alternative instances to those already defined, or for defining instances for types that we don’t control.</p>

<p>For example, the <code class="language-plaintext highlighter-rouge">Ordering</code> type class in Scala has default instances for primitives, but the order is ascending:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.math.Ordering</span>
<span class="k">import</span> <span class="nn">scala.collection.immutable.SortedSet</span>

<span class="n">implicitly</span><span class="o">[</span><span class="kt">Ordering</span><span class="o">[</span><span class="kt">Int</span><span class="o">]].</span><span class="py">compare</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
<span class="c1">//=&gt; -1</span>

<span class="nc">SortedSet</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
<span class="c1">//=&gt; TreeSet(1, 2, 3, 5, 9, 10)</span>
</code></pre></div></div>

<p>If we want a different ordering, it’s a very bad practice to redefine the available instance. The best practice is to define a newtype:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">ReversedInt</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">toString</span> <span class="k">=</span> <span class="nv">value</span><span class="o">.</span><span class="py">toString</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">ReversedInt</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">ord</span><span class="k">:</span> <span class="kt">Ordering</span><span class="o">[</span><span class="kt">ReversedInt</span><span class="o">]</span> <span class="k">=</span>
    <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">implicitly</span><span class="o">[</span><span class="kt">Ordering</span><span class="o">[</span><span class="kt">Int</span><span class="o">]].</span><span class="py">compare</span><span class="o">(</span><span class="nv">x</span><span class="o">.</span><span class="py">value</span><span class="o">,</span> <span class="nv">y</span><span class="o">.</span><span class="py">value</span><span class="o">)</span>
<span class="o">}</span>

<span class="nc">SortedSet</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="nc">ReversedInt</span><span class="o">(</span><span class="k">_</span><span class="o">))</span><span class="k">:_</span><span class="kt">*</span><span class="o">)</span>
<span class="c1">//=&gt; TreeSet(10, 9, 5, 3, 2, 1)</span>
</code></pre></div></div>

<h2 id="the-librarys-purpose">The library’s purpose</h2>

<p>Working with case classes, like the above, is completely fine. However, they have a runtime cost, generating extra boxing and unboxing. Also, you may want to add extra validation, or to derive type class instances.</p>

<p>Scala 3 has introduced <a href="https://docs.scala-lang.org/scala3/reference/other-new-features/opaques.html">opaque types</a> for this purpose. These are type-safe aliases that have no added runtime cost. However, it would be nice to have some helpers in a cross-compiled fashion that also provides an encoding compatible with Scala 2.</p>

<p>We already had <a href="https://github.com/estatico/scala-newtype">scala-newtype</a>, a pretty awesome project. Monix’s Newtypes is inspired by it. The purpose of this project is to be stable and easy to port. That means no macros, and no magic based on implicits.</p>
</section></div></div></div></div><script src="/highlight/highlight.pack.js"></script><script src="/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'monix/monix'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/search.js"></script><script src="/js/docs.js"></script></body></html>